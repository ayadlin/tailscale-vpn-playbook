name: Lint

on:
  pull_request:
  push:
    branches: ["main", "master", "Claude"]

jobs:
  markdownlint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Markdownlint
        uses: DavidAnson/markdownlint-cli2-action@v17
        with:
          globs: |
            **/*.md

  shellcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: ShellCheck
        uses: ludeeus/action-shellcheck@master
        with:
          scandir: ./scripts

  powershell:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install PSScriptAnalyzer
        shell: pwsh
        run: Install-Module PSScriptAnalyzer -Force -Scope CurrentUser
      - name: Analyze PowerShell scripts
        shell: pwsh
        run: |
          $results = Invoke-ScriptAnalyzer -Path .\scripts\windows -Recurse -Severity Warning,Error
          if ($results) {
            $results | Format-Table
            throw "PSScriptAnalyzer found issues."
          }
